<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ONNX Model Security Scanner - Scan ONNX machine learning models for security threats before loading">
    <meta name="keywords" content="ONNX, Security Scanner, Machine Learning, AI Security, Model Scanner">
    <title>ONNX Model Security Scanner | John Kenedy</title>
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.1/dist/ort.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --text-color: #333;
            --light-bg: #ecf0f1;
            --white: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 20px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-bg);
        }

        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            padding: 2rem 0;
            box-shadow: var(--shadow);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .logo p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        nav a:hover {
            opacity: 0.8;
        }

        .content-card {
            background: var(--white);
            border-radius: 8px;
            padding: 3rem;
            margin: 3rem auto;
            box-shadow: var(--shadow);
        }

        h2 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 1.5rem;
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 0.5rem;
        }

        h3 {
            color: var(--secondary-color);
            font-size: 1.4rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .hero-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
            margin-bottom: 2rem;
        }

        .hero-text h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero-text .tagline {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 1.5rem;
        }

        .hero-image img {
            width: 100%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: var(--shadow-hover);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            opacity: 0.9;
            transition: opacity 0.3s;
        }

        .back-link:hover {
            opacity: 1;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .feature-card {
            background: var(--light-bg);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid var(--secondary-color);
        }

        .feature-card h4 {
            color: var(--primary-color);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .feature-card p {
            color: #666;
            font-size: 0.95rem;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-top: 1.5rem;
        }

        .tech-tag {
            background: var(--secondary-color);
            color: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        footer {
            background: var(--primary-color);
            color: var(--white);
            text-align: center;
            padding: 2rem 0;
            margin-top: 4rem;
        }

        /* Scanner Specific Styles */
        .scanner-section {
            margin-top: 3rem;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section h3 {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 0;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: block;
            padding: 20px;
            background: var(--light-bg);
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            background: #dfe6e9;
            border-color: var(--secondary-color);
        }

        .file-input-label.has-file {
            background: #d4edda;
            border-color: #28a745;
        }

        .button {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        .button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .button.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .button.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .info-box {
            background: var(--light-bg);
            border-left: 4px solid var(--secondary-color);
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }

        .info-box h4 {
            font-size: 14px;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .info-box p, .info-box li {
            font-size: 13px;
            color: #4a5568;
            line-height: 1.6;
        }

        .info-box ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: start;
            gap: 12px;
        }

        .alert-critical {
            background: #fde8e8;
            border: 2px solid var(--accent-color);
            color: #742a2a;
        }

        .alert-warning {
            background: #fef5e7;
            border: 2px solid #f39c12;
            color: #744210;
        }

        .alert-info {
            background: #e8f4fd;
            border: 2px solid var(--secondary-color);
            color: #2c5282;
        }

        .alert-success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #22543d;
        }

        .alert-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .findings-list {
            margin-top: 10px;
            font-size: 13px;
        }

        .findings-list li {
            margin: 5px 0;
            padding: 5px;
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
        }

        .output-box {
            background: var(--primary-color);
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .output-box:empty::before {
            content: 'Output will appear here...';
            color: #718096;
            font-style: italic;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .use-cases {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--white);
            border-radius: 8px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .use-cases h3 {
            color: var(--white);
            margin-top: 0;
        }

        .use-cases ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .use-cases li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            display: flex;
            flex-wrap: wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .use-cases li:before {
            content: ">";
            position: absolute;
            left: 0;
            font-weight: bold;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .hero-section {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .hero-text h1 {
                font-size: 2rem;
            }

            .hero-image {
                order: -1;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .content-card {
                padding: 1.5rem;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            nav ul {
                gap: 1rem;
            }

            .use-cases {
                padding: 1.5rem;
            }

            .use-cases ul {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .use-cases li {
                padding-left: 1.2rem;
                font-size: 0.95rem;
                line-height: 1.5;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>John Kenedy</h1>
                    <p>Senior Software Developer</p>
                </div>
                <nav>
                    <ul>
                        <li><a href="index.html" class="back-link"><span>&larr;</span> Back to Portfolio</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="content-card">
            <div class="hero-section">
                <div class="hero-text">
                    <h1>ONNX Model Security Scanner</h1>
                    <p class="tagline">Scan Before You Load</p>
                    <p>
                        Protect your systems from malicious machine learning models. This security scanner analyzes
                        ONNX models for embedded URLs, code execution patterns, suspicious file paths, and other
                        potential threats before loading them into ONNX Runtime.
                    </p>
                </div>
                <div class="hero-image">
                    <img src="content/onnx.png" alt="ONNX Security Scanner Screenshot">
                </div>
            </div>

            <h2>Security Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <h4>URL Detection</h4>
                    <p>Scans for embedded HTTP/HTTPS URLs that could be used for data exfiltration or command-and-control communication.</p>
                </div>
                <div class="feature-card">
                    <h4>Custom Operator Detection</h4>
                    <p>Identifies non-standard operator domains that may contain custom code execution capabilities.</p>
                </div>
                <div class="feature-card">
                    <h4>External Data References</h4>
                    <p>Detects references to external data files that could be used to load malicious payloads.</p>
                </div>
                <div class="feature-card">
                    <h4>Code Execution Patterns</h4>
                    <p>Searches for dangerous patterns like eval(), exec(), subprocess calls that indicate potential code execution.</p>
                </div>
                <div class="feature-card">
                    <h4>Embedded Executables</h4>
                    <p>Detects PE (Windows) and ELF (Linux) executable headers that may indicate embedded malware.</p>
                </div>
                <div class="feature-card">
                    <h4>Network Operations</h4>
                    <p>Identifies network-related strings like socket, connect, curl that could enable remote communication.</p>
                </div>
                <div class="feature-card">
                    <h4>File Path Analysis</h4>
                    <p>Detects suspicious file paths including path traversal attempts and system directory references.</p>
                </div>
                <div class="feature-card">
                    <h4>Entropy Analysis</h4>
                    <p>Calculates file entropy to detect encrypted or heavily obfuscated content that may hide malicious code.</p>
                </div>
            </div>

            <div class="use-cases">
                <h3>Why Scan ONNX Models?</h3>
                <ul>
                    <li>Models from untrusted sources may contain malware</li>
                    <li>Supply chain attacks target ML pipelines</li>
                    <li>Custom operators can execute arbitrary code</li>
                    <li>External data references can load payloads</li>
                    <li>Embedded URLs enable C2 communication</li>
                    <li>Protect production environments</li>
                </ul>
            </div>

            <!-- Scanner Tool Section -->
            <div class="scanner-section">
                <h2>Try the Scanner</h2>

                <!-- File Upload Section -->
                <div class="section">
                    <h3>Step 1: Select ONNX Model</h3>
                    <div class="file-input-wrapper">
                        <input type="file" id="fileInput" accept=".onnx">
                        <label class="file-input-label" id="fileLabel">
                            <div style="font-size: 40px; margin-bottom: 10px;">üì§</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">Click to select ONNX file</div>
                            <div style="font-size: 12px; color: #718096;">File will be scanned for security threats</div>
                        </label>
                    </div>
                    <button class="button" id="scanBtn" disabled>Scan for Security Threats</button>
                </div>

                <!-- Security Scan Results -->
                <div class="section" id="scanResultsSection" style="display: none;">
                    <h3>Step 2: Security Scan Results</h3>
                    <div id="scanResults"></div>
                    <button class="button" id="loadBtn" style="display: none;">Proceed to Load Model</button>
                </div>

                <!-- Model Info Section -->
                <div class="section" id="modelInfoSection" style="display: none;">
                    <h3>Step 3: Model Information</h3>
                    <div class="info-box" id="modelInfo"></div>
                </div>

                <!-- Inference Section -->
                <div class="section" id="inferenceSection" style="display: none;">
                    <h3>Step 4: Run Inference (Example)</h3>
                    <div class="info-box">
                        <p><strong>Note:</strong> This runs with random input data for testing purposes.</p>
                    </div>
                    <button class="button" id="inferBtn">Run Inference with Random Data</button>
                    <div id="inferStatus"></div>
                </div>

                <!-- Output Section -->
                <div class="section">
                    <h3>Detailed Output</h3>
                    <div class="output-box" id="output"></div>
                </div>
            </div>

            <h3>Technology Stack</h3>
            <div class="tech-stack">
                <span class="tech-tag">JavaScript</span>
                <span class="tech-tag">ONNX Runtime Web</span>
                <span class="tech-tag">WebAssembly</span>
                <span class="tech-tag">Pattern Matching</span>
                <span class="tech-tag">Entropy Analysis</span>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 John Kenedy. All rights reserved.</p>
            <p style="margin-top: 0.5rem; font-size: 0.9rem;">Senior Software Developer | Singapore</p>
        </div>
    </footer>

    <script>
        let session = null;
        let modelFile = null;
        let modelArrayBuffer = null;
        let scanPassed = false;

        const fileInput = document.getElementById('fileInput');
        const fileLabel = document.getElementById('fileLabel');
        const scanBtn = document.getElementById('scanBtn');
        const scanResultsSection = document.getElementById('scanResultsSection');
        const scanResults = document.getElementById('scanResults');
        const loadBtn = document.getElementById('loadBtn');
        const modelInfoSection = document.getElementById('modelInfoSection');
        const modelInfo = document.getElementById('modelInfo');
        const inferenceSection = document.getElementById('inferenceSection');
        const inferBtn = document.getElementById('inferBtn');
        const inferStatus = document.getElementById('inferStatus');
        const output = document.getElementById('output');

        // File selection
        fileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                modelFile = e.target.files[0];
                fileLabel.classList.add('has-file');
                fileLabel.innerHTML = `
                    <div style="font-size: 40px; margin-bottom: 10px;">‚úÖ</div>
                    <div style="font-weight: 600; margin-bottom: 5px;">${modelFile.name}</div>
                    <div style="font-size: 12px; color: #718096;">${(modelFile.size / 1024 / 1024).toFixed(2)} MB</div>
                `;
                scanBtn.disabled = false;
                scanResultsSection.style.display = 'none';
                modelInfoSection.style.display = 'none';
                inferenceSection.style.display = 'none';
                output.textContent = '';
                scanPassed = false;
            }
        });

        // Security scan
        scanBtn.addEventListener('click', async function() {
            if (!modelFile) return;

            scanBtn.disabled = true;
            output.textContent = 'Starting security scan...\n';
            output.textContent += '========================\n\n';

            try {
                // Read file
                modelArrayBuffer = await modelFile.arrayBuffer();
                const uint8Array = new Uint8Array(modelArrayBuffer);

                output.textContent += `File: ${modelFile.name}\n`;
                output.textContent += `Size: ${(modelFile.size / 1024 / 1024).toFixed(2)} MB\n\n`;

                // Perform security scan
                const findings = await performSecurityScan(uint8Array);

                // Display results
                displayScanResults(findings);

                scanResultsSection.style.display = 'block';

            } catch (error) {
                output.textContent += `\n‚ùå Error during scan:\n${error.message}\n`;
                scanResults.innerHTML = `<div class="alert alert-critical">
                    <div class="alert-icon">‚ö†Ô∏è</div>
                    <div class="alert-content">
                        <div class="alert-title">Scan Error</div>
                        <div>${error.message}</div>
                    </div>
                </div>`;
            } finally {
                scanBtn.disabled = false;
            }
        });

        // Perform security scan
        async function performSecurityScan(data) {
            const findings = {
                critical: [],
                warnings: [],
                info: [],
                safe: []
            };

            output.textContent += 'Running security checks...\n\n';

            // Convert to text for pattern matching
            const decoder = new TextDecoder('utf-8', { fatal: false });
            const textContent = decoder.decode(data);

            // 1. Check for URLs (HTTP/HTTPS)
            output.textContent += '[1/8] Checking for embedded URLs...\n';
            const urlPattern = /(https?:\/\/[^\s"'<>]+)/gi;
            const urls = textContent.match(urlPattern) || [];
            if (urls.length > 0) {
                const uniqueUrls = [...new Set(urls)];
                findings.critical.push({
                    type: 'URLs Found',
                    message: `Found ${uniqueUrls.length} embedded URL(s) in model`,
                    details: uniqueUrls
                });
                output.textContent += `  ‚ö†Ô∏è CRITICAL: Found ${uniqueUrls.length} URL(s)\n`;
                uniqueUrls.forEach(url => output.textContent += `     - ${url}\n`);
            } else {
                findings.safe.push('No HTTP/HTTPS URLs found');
                output.textContent += `  ‚úì No URLs found\n`;
            }

            // 2. Check for custom operators/domains
            output.textContent += '\n[2/8] Checking for custom operators...\n';
            const customDomainPattern = /domain\s*[:=]\s*["']([^"']+)["']/gi;
            const customDomains = [];
            let match;
            while ((match = customDomainPattern.exec(textContent)) !== null) {
                customDomains.push(match[1]);
            }

            const standardDomains = ['ai.onnx', 'ai.onnx.ml', 'com.microsoft'];
            const nonStandardDomains = customDomains.filter(d => !standardDomains.includes(d));

            if (nonStandardDomains.length > 0) {
                findings.warnings.push({
                    type: 'Custom Operators',
                    message: `Found custom operator domain(s)`,
                    details: [...new Set(nonStandardDomains)]
                });
                output.textContent += `  ‚ö†Ô∏è WARNING: Custom domains found\n`;
                nonStandardDomains.forEach(d => output.textContent += `     - ${d}\n`);
            } else if (customDomains.length > 0) {
                findings.safe.push('Only standard ONNX domains found');
                output.textContent += `  ‚úì Only standard domains\n`;
            } else {
                output.textContent += `  ‚úì No custom domains\n`;
            }

            // 3. Check for external data references
            output.textContent += '\n[3/8] Checking for external data references...\n';
            const externalDataPattern = /external_data|location\s*[:=]/gi;
            const hasExternalData = externalDataPattern.test(textContent);
            if (hasExternalData) {
                findings.warnings.push({
                    type: 'External Data',
                    message: 'Model references external data files',
                    details: ['Model may load data from external files']
                });
                output.textContent += `  ‚ö†Ô∏è WARNING: External data references found\n`;
            } else {
                findings.safe.push('No external data references');
                output.textContent += `  ‚úì No external data references\n`;
            }

            // 4. Check for file paths
            output.textContent += '\n[4/8] Checking for suspicious file paths...\n';
            const pathPatterns = [
                /\.\.[\/\\]/g,  // Path traversal
                /[A-Za-z]:[\\][^\s"']*/g,  // Windows paths
                /\/etc\/[^\s"']*/g,  // Linux system paths
                /\/usr\/[^\s"']*/g,
                /\/var\/[^\s"']*/g,
                /\/home\/[^\s"']*/g,
                /\/tmp\/[^\s"']*/g,
                /\/opt\/[^\s"']*/g,
                /\/root\/[^\s"']*/g
            ];

            let pathsFound = [];
            pathPatterns.forEach(pattern => {
                const matches = textContent.match(pattern) || [];
                pathsFound = pathsFound.concat(matches);
            });

            // Remove duplicates while preserving all paths
            const uniquePaths = [...new Set(pathsFound)];

            if (uniquePaths.length > 0) {
                findings.warnings.push({
                    type: 'File Paths',
                    message: `Found ${uniquePaths.length} suspicious file path(s)`,
                    details: uniquePaths  // ALL paths, no truncation
                });
                output.textContent += `  ‚ö†Ô∏è WARNING: Found ${uniquePaths.length} file path(s)\n`;
                output.textContent += `  Listing ALL detected paths:\n`;
                uniquePaths.forEach((path, idx) => {
                    output.textContent += `     ${idx + 1}. ${path}\n`;
                });
            } else {
                output.textContent += `  ‚úì No suspicious paths\n`;
            }

            // 5. Check for code execution patterns
            output.textContent += '\n[5/8] Checking for code execution patterns...\n';
            const dangerousPatterns = [
                'eval(', 'exec(', 'system(', 'subprocess', 'popen(',
                '__import__', 'compile(', 'execfile(', 'globals(',
                'locals(', 'execvp(', 'fork(', 'spawn('
            ];

            const foundPatterns = dangerousPatterns.filter(p => textContent.includes(p));
            if (foundPatterns.length > 0) {
                findings.critical.push({
                    type: 'Code Execution',
                    message: 'Code execution patterns detected',
                    details: foundPatterns
                });
                output.textContent += `  ‚ö†Ô∏è CRITICAL: Code execution patterns found\n`;
                foundPatterns.forEach(p => output.textContent += `     - ${p}\n`);
            } else {
                findings.safe.push('No code execution patterns');
                output.textContent += `  ‚úì No code execution patterns\n`;
            }

            // 6. Check for embedded executables
            output.textContent += '\n[6/8] Checking for embedded executables...\n';
            const hasPE = data[0] === 0x4D && data[1] === 0x5A; // MZ
            const hasELF = data[0] === 0x7F && data[1] === 0x45 &&
                          data[2] === 0x4C && data[3] === 0x46; // ELF

            if (hasPE || hasELF) {
                findings.critical.push({
                    type: 'Embedded Executable',
                    message: `Embedded ${hasPE ? 'PE (Windows)' : 'ELF (Linux)'} executable detected`,
                    details: ['File contains executable code headers']
                });
                output.textContent += `  ‚ö†Ô∏è CRITICAL: Embedded executable found\n`;
            } else {
                findings.safe.push('No embedded executables');
                output.textContent += `  ‚úì No embedded executables\n`;
            }

            // 7. Check for network-related strings
            output.textContent += '\n[7/8] Checking for network operations...\n';
            const networkPatterns = ['socket', 'connect(', 'send(', 'recv(', 'curl', 'wget', 'fetch('];
            const foundNetwork = networkPatterns.filter(p => textContent.includes(p));

            if (foundNetwork.length > 0) {
                findings.warnings.push({
                    type: 'Network Operations',
                    message: 'Network operation strings detected',
                    details: foundNetwork
                });
                output.textContent += `  ‚ö†Ô∏è WARNING: Network patterns found\n`;
            } else {
                output.textContent += `  ‚úì No network operations\n`;
            }

            // 8. File entropy check
            output.textContent += '\n[8/8] Checking file entropy...\n';
            const entropy = calculateEntropy(data.slice(0, 10000));
            findings.info.push(`File entropy: ${entropy.toFixed(2)}`);

            if (entropy > 7.9) {
                findings.warnings.push({
                    type: 'High Entropy',
                    message: 'Unusually high entropy detected',
                    details: [`Entropy: ${entropy.toFixed(2)} (may indicate encryption or compression)`]
                });
                output.textContent += `  ‚ö†Ô∏è High entropy: ${entropy.toFixed(2)}\n`;
            } else {
                output.textContent += `  ‚úì Normal entropy: ${entropy.toFixed(2)}\n`;
            }

            output.textContent += '\n‚úÖ Security scan complete!\n\n';
            return findings;
        }

        function calculateEntropy(data) {
            const freq = new Array(256).fill(0);
            data.forEach(byte => freq[byte]++);

            let entropy = 0;
            const len = data.length;

            freq.forEach(count => {
                if (count > 0) {
                    const p = count / len;
                    entropy -= p * Math.log2(p);
                }
            });

            return entropy;
        }

        function displayScanResults(findings) {
            let html = '';
            let riskLevel = 'safe';

            // Critical findings
            if (findings.critical.length > 0) {
                riskLevel = 'critical';
                html += `<div class="alert alert-critical">
                    <div class="alert-icon">üö®</div>
                    <div class="alert-content">
                        <div class="alert-title">CRITICAL THREATS DETECTED (${findings.critical.length})</div>
                        <p>This model contains high-risk elements. Loading is NOT recommended.</p>
                        <ul class="findings-list">`;

                findings.critical.forEach(f => {
                    html += `<li><strong>${f.type}:</strong> ${f.message}`;
                    if (f.details && f.details.length > 0) {
                        html += `<ul style="margin-top: 5px;">`;
                        f.details.forEach(d => {
                            html += `<li style="font-size: 12px;">${d}</li>`;
                        });
                        html += `</ul>`;
                    }
                    html += `</li>`;
                });

                html += `</ul></div></div>`;
            }

            // Warnings
            if (findings.warnings.length > 0 && riskLevel === 'safe') {
                riskLevel = 'warning';
            }

            if (findings.warnings.length > 0) {
                html += `<div class="alert alert-warning">
                    <div class="alert-icon">‚ö†Ô∏è</div>
                    <div class="alert-content">
                        <div class="alert-title">WARNINGS (${findings.warnings.length})</div>
                        <p>Potential security concerns detected. Proceed with caution.</p>
                        <ul class="findings-list">`;

                findings.warnings.forEach(f => {
                    html += `<li><strong>${f.type}:</strong> ${f.message}`;
                    if (f.details && f.details.length > 0) {
                        html += `<ul style="margin-top: 5px; max-height: 400px; overflow-y: auto;">`;
                        f.details.forEach(d => {
                            html += `<li style="font-size: 12px; word-break: break-all;">${d}</li>`;
                        });
                        html += `</ul>`;
                    }
                    html += `</li>`;
                });

                html += `</ul></div></div>`;
            }

            // Safe findings
            if (findings.safe.length > 0) {
                html += `<div class="alert alert-success">
                    <div class="alert-icon">‚úÖ</div>
                    <div class="alert-content">
                        <div class="alert-title">PASSED CHECKS (${findings.safe.length})</div>
                        <ul class="findings-list">`;

                findings.safe.forEach(s => {
                    html += `<li>${s}</li>`;
                });

                html += `</ul></div></div>`;
            }

            // Info
            if (findings.info.length > 0) {
                html += `<div class="alert alert-info">
                    <div class="alert-icon">‚ÑπÔ∏è</div>
                    <div class="alert-content">
                        <div class="alert-title">ADDITIONAL INFORMATION</div>
                        <ul class="findings-list">`;

                findings.info.forEach(i => {
                    html += `<li>${i}</li>`;
                });

                html += `</ul></div></div>`;
            }

            scanResults.innerHTML = html;

            // Show load button with appropriate styling
            loadBtn.style.display = 'block';
            if (riskLevel === 'critical') {
                loadBtn.className = 'button danger';
                loadBtn.textContent = '‚ö†Ô∏è Load Anyway (NOT RECOMMENDED)';
                scanPassed = false;
            } else if (riskLevel === 'warning') {
                loadBtn.className = 'button warning';
                loadBtn.textContent = '‚ö†Ô∏è Proceed with Caution';
                scanPassed = true;
            } else {
                loadBtn.className = 'button';
                loadBtn.textContent = '‚úÖ Proceed to Load Model';
                scanPassed = true;
            }
        }

        // Load model
        loadBtn.addEventListener('click', async function() {
            if (!modelArrayBuffer) return;

            loadBtn.disabled = true;
            output.textContent += '\n\nLoading model into ONNX Runtime...\n';
            output.textContent += '===================================\n\n';

            try {
                session = await ort.InferenceSession.create(modelArrayBuffer);

                output.textContent += '‚úÖ Model loaded successfully!\n\n';

                displayModelInfo();

                modelInfoSection.style.display = 'block';
                inferenceSection.style.display = 'block';

            } catch (error) {
                output.textContent += `\n‚ùå Error loading model:\n${error.message}\n\n`;
                output.textContent += 'Stack trace:\n' + error.stack;
            } finally {
                loadBtn.disabled = false;
            }
        });

        function displayModelInfo() {
            output.textContent += 'Model Information:\n';
            output.textContent += '===================\n';

            let info = '<h4>Model Metadata</h4>';

            if (session.inputNames) {
                const inputNames = session.inputNames;
                info += `<p><strong>Inputs:</strong> ${inputNames.length}</p>`;
                output.textContent += `Input names: ${inputNames.join(', ')}\n`;

                info += '<h4 style="margin-top: 15px;">Input Details</h4>';
                inputNames.forEach(name => {
                    output.textContent += `\nInput: ${name}\n`;
                    info += `<p><strong>${name}:</strong> Shape information not available in ONNX Runtime Web</p>`;
                });
            }

            if (session.outputNames) {
                const outputNames = session.outputNames;
                info += `<p><strong>Outputs:</strong> ${outputNames.length}</p>`;
                output.textContent += `\nOutput names: ${outputNames.join(', ')}\n`;

                info += '<h4 style="margin-top: 15px;">Output Details</h4>';
                outputNames.forEach(name => {
                    output.textContent += `\nOutput: ${name}\n`;
                    info += `<p><strong>${name}:</strong> Shape information not available in ONNX Runtime Web</p>`;
                });
            }

            modelInfo.innerHTML = info;
            output.textContent += '\n';
        }

        // Run inference
        inferBtn.addEventListener('click', async function() {
            if (!session) return;

            inferBtn.disabled = true;
            inferStatus.innerHTML = '<div class="alert alert-info"><div class="alert-icon"><span class="loading"></span></div><div class="alert-content">Running inference...</div></div>';
            output.textContent += '\nRunning inference with random data...\n';
            output.textContent += '=====================================\n';

            try {
                const feeds = {};

                session.inputNames.forEach(name => {
                    const dims = [1, 3, 224, 224]; // Default shape
                    const size = dims.reduce((a, b) => a * b, 1);

                    const data = new Float32Array(size);
                    for (let i = 0; i < size; i++) {
                        data[i] = Math.random();
                    }

                    feeds[name] = new ort.Tensor('float32', data, dims);
                    output.textContent += `Input "${name}": shape ${dims.join(' √ó ')}, ${size} elements\n`;
                });

                output.textContent += '\nExecuting model...\n';
                const startTime = performance.now();
                const results = await session.run(feeds);
                const endTime = performance.now();

                output.textContent += `\n‚úÖ Inference completed in ${(endTime - startTime).toFixed(2)}ms\n\n`;
                output.textContent += 'Output Results:\n';
                output.textContent += '===============\n';

                for (const name in results) {
                    const tensor = results[name];
                    output.textContent += `\nOutput "${name}":\n`;
                    output.textContent += `  Shape: ${tensor.dims.join(' √ó ')}\n`;
                    output.textContent += `  Type: ${tensor.type}\n`;
                    output.textContent += `  Data (first 10): [${Array.from(tensor.data.slice(0, 10)).map(v => v.toFixed(4)).join(', ')}...]\n`;
                }

                inferStatus.innerHTML = `<div class="alert alert-success"><div class="alert-icon">‚úÖ</div><div class="alert-content">Inference completed in ${(endTime - startTime).toFixed(2)}ms</div></div>`;

            } catch (error) {
                output.textContent += `\n‚ùå Error during inference:\n${error.message}\n`;
                inferStatus.innerHTML = `<div class="alert alert-critical"><div class="alert-icon">‚ùå</div><div class="alert-content">${error.message}</div></div>`;
            } finally {
                inferBtn.disabled = false;
            }
        });

        output.textContent = 'Select an ONNX file to begin security scanning...\n';
    </script>
</body>
</html>
